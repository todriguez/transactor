<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRANSTRUCTOR</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script> var exports = {}; </script>
    <style>
        .pre-tooltip {
          text-align: left;
        }
      </style>
</head>

<body>

<div class="container mt-4">
    <h1 class="mb-4" style="text-align: center;">BSV TX PLAYGROUND</h1>

  <div><p>To start building bitcoin transactions, we need to generate public and private keys which we can use for our locking and unlocking transaction outputs as well as signing transactions and messages.</p>
        <button id="generatekeypair" class="btn btn-primary mt-2" style="display: block; margin-left: auto; margin-right: auto;">Generate Key Pair</button>
        <div>
            <table id="keypair" class="table table-striped mt-4">
                <thead>
                    <tr>
                        <th>Index</th>
                        <th>Public Key</th>
                        <th>Private Key</th>
                        <th>Address</th>
                    </tr>
                </thead>
                <tbody id="keypairTableBody"></tbody>
            </table>
        </div>
        <div class="mb-3">
            <label for="keyPairSelector" class="form-label">Select key pair index:</label>
            <select class="form-select" id="keyPairSelector" name="keyPairSelector"></select>
            <a class="key-pair-info" data-bs-toggle="collapse" href="#keyPairInfoContent" aria-expanded="false" aria-controls="keyPairInfoContent">Key Pair Info</a>
            <div class="collapse" id="keyPairInfoContent">
              <p>From the keys generated above, select a key pair to mine blocks with.</p>
              <p>The key pair will be used to mine 110 blocks on a Bitcoin RegTest Network. Each mined block's coinbase transaction requires these keys to spend its outputs.</p>
              <p>The reason we mine 110 blocks is that coinbase transactions are only spendable after they have satisfied the coinbase block maturity rule of being over 100 blocks deep in the chain.</p>
              <p><strong>Please note:</strong> It may take up to 10 seconds for the mined blocks to be returned and populate the table.</p>
            </div>
          </div>
          
      <div class="mb-3">
      <button id="mineBlocks" class="btn btn-primary mt-2" style="display: block; margin-left: auto; margin-right: auto;">Mine Blocks</button>
      </div>
  </div>
                                    
  <div id="spendableTransactionOutputs" class="mt-4">
      <h2 style="text-align: center;">Spendable Transaction Outputs</h2>
        <div id="stoContainer"></div>
  </div>

  <div>
      <button class="btn btn-link p-0" type="button" data-bs-toggle="collapse" data-bs-target="#conversionToolsContent">
        Conversion Tools
      </button>
      <div class="collapse" id="conversionToolsContent">
        <!-- Input box for converting bitcoins to satoshis -->
        <div class="mb-3">
            <label for="btcToSatoshis" class="form-label">Bitcoins to Satoshis:</label>
            <input type="text" class="form-control" id="btcToSatoshis">
            <button id="btcToSatoshisButton" class="btn btn-primary mt-2" type="button">Convert</button>
            <p id="btcToSatoshisResult"></p>
        </div>

        <!-- Input box for converting decimal to hexadecimal -->
        <div class="mb-3">
            <label for="decimalToHex" class="form-label">Decimal to Hexadecimal:</label>
            <input type="text" class="form-control" id="decimalToHex">
            <button id="decimalToHexButton" class="btn btn-primary mt-2" type="button">Convert</button>
            <p id="decimalToHexResult"></p>
        </div>

        <!-- Input box for changing endianness -->
        <div class="mb-3">
            <label for="switchEndian" class="form-label">Switch Endianness:</label>
            <input type="text" class="form-control" id="switchEndian">
            <button id="switchEndianButton" class="btn btn-primary mt-2" type="button">Convert</button>
            <p id="switchEndianResult"></p>
        </div>
      </div>
  </div>

  <div id="transactionContainer" class="mt-4">
    <button type="button" class="btn btn-link p-0" data-bs-toggle="collapse" data-bs-target="#transactionContent">
        <h1 style="text-align: center;">Create Transaction</h1>
    </button>
      
    <div class="mb-3">
        <label for="Version" class="form-label">Version:</label>
        <input type="text" class="form-control" id="version" name="Version">
        <a class="version-info" data-bs-toggle="collapse" href="#versionInfoContent" aria-expanded="false" aria-controls="versionInfoContent">Version Info</a>
        <div class="collapse" id="versionInfoContent">
          <p>The "Version" is the first data field of a transaction. It expects a 4-byte hexadecimal value in Little Endian notation.</p>
          <p>For example, Version 1 would be represented as 01000000.</p>
          <p>Bitcoin transaction version numbers are used to signal to the network what type of transaction it is and what rules it follows. This provides an efficient way for miners to know how to handle that particular type of transaction.</p>
        </div>
    </div>
      
    <div class="mb-3">
      <label for="inputCount" class="form-label">Input Count:</label>
      <input type="text" class="form-control" id="inputCount" name="inputCount">
      <a class="input-count-info" data-bs-toggle="collapse" href="#inputCountInfoContent" aria-expanded="false" aria-controls="inputCountInfoContent">Input Count Info</a>
        <div class="collapse" id="inputCountInfoContent">
          <p>Input Count is a varInt which specifies the number of Spendable Transaction Outputs that will be committed to the transaction. This will be either a 1, 3, 5, or 9-byte value.</p>
          <p>The forms for each input will be dynamically created when a value is entered in the field above. This tool only allows for a maximum of 5 inputs. </p>
          <p>The following table explains how to specify a number as a VarInt in Bitcoin:</p>
          <div>
            <table class="table mt-2 border border-dark">
              <thead>
                <tr>
                  <th>Size</th>
                  <th>Example</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>&lt;= 0xfc</td>
                  <td>12</td>
                  <td></td>
                </tr>
                <tr>
                  <td>&lt;= 0xffff</td>
                  <td>fd1234</td>
                  <td>Prefix with fd, and the next 2 bytes are the VarInt (in little-endian).</td>
                </tr>
                <tr>
                  <td>&lt;= 0xffffffff</td>
                  <td>fe12345678</td>
                  <td>Prefix with fe, and the next 4 bytes are the VarInt (in little-endian).</td>
                </tr>
                <tr>
                  <td>&lt;= 0xffffffffffffffff</td>
                  <td>ff1234567890abcdef</td>
                  <td>Prefix with ff, and the next 8 bytes are the VarInt (in little-endian).</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
    </div>

    <template id="inputContainerTemplate">
        <div class="inputContainer mt-4">
          <button type="button" class="btn btn-link p-0 inputToggle" data-bs-toggle="collapse">
              <h3>Input #<span class="inputIndex"></span></h3>
          </button>
            <div class="collapse show inputContent">

              <div class="mb-3">
                  <label for="inputTXID-0" class="form-label">TXID:</label>
                  <input type="text" class="form-control" name="inputTXID" id="inputTXID-0">
                  <a class="input-txid-info" data-bs-toggle="collapse" href="#inputTXIDInfoContent" aria-expanded="false" aria-controls="inputTXIDInfoContent">TXID Info</a>
                  <div class="collapse" id="inputTXIDInfoContent">
                    <p>Enter the TXID that contains the outputs you want to spend.</p>
                    <p><strong>Please note:</strong> The Spendable Transaction Output table displays a Big Endian TXID, but this form field expects a 32-byte Little Endian value.</p>
                    <p>Expand the conversion tools container underneath the Spendable Transaction Outputs Table to switch the endianness.</p>
                  </div>
                </div>

                <div class="mb-3">
                  <label for="inputVOUT-0" class="form-label">VOUT:</label>
                  <input type="text" class="form-control" name="inputVOUT" id="inputVOUT-0">
                  <a class="input-vout-info" data-bs-toggle="collapse" href="#inputVOUTInfoContent" aria-expanded="false" aria-controls="inputVOUTInfoContent">VOUT Info</a>
                    <div class="collapse" id="inputVOUTInfoContent">
                      <p>The VOUT refers to the index position of the Transaction Output you want to spend from amongst whichever additional outputs were generated when the initial transaction was created.</p>
                      <p>In this case, all our Spendable Transaction Outputs are from coinbase transactions with only one output, so their VOUT will be 0 as the first position in the transaction outputs.</p>
                      <p>This needs to be entered as a 4-byte Little Endian value. E.g. 00000000 or 01000000.</p>
                    </div>
                </div>

                <div class="mb-3">
                  <label for="inputUnlockScriptSize-0" class="form-label">Unlock Script Size:</label>
                  <input type="text" class="form-control" name="inputUnlockScriptSize" id="inputUnlockScriptSize-0">
                  <a class="input-unlock-script-size-info" data-bs-toggle="collapse" href="#inputUnlockScriptSizeInfoContent" aria-expanded="false" aria-controls="inputUnlockScriptSizeInfoContent">Unlock Script Size Info</a>
                    <div class="collapse" id="inputUnlockScriptSizeInfoContent">
                      <p>The Unlock Script Size is a varInt that at this point specifies the length of the lockScript from the STO (Spendable Transaction Output) that is being spent.</p>
                      <p>Despite the data field label, we use the lockScript at this point because we can't generate the unlockScript, which might require a signature, until we've prepared the rest of the transaction data. Some transactions outputs may not require a signature at all in which case we would simply provide the size of the solution to that input's lockScript. However, since we want to spend the satoshis from the coinbase block reward which are encumbered by a P2PKH lockScript, a signature is required as stipulated by the OP_CHECKSIG opcode in the lockScript (ASM). In that case, we use the lockScript as placeholder data when creating the preimage that is hashed to yield the message that will be signed.</p>
                      <p>Here is a simplified version of the process:</p>
                      <ol>
                        <li>Gather input and output information, including txid(s), vout(s), private key(s), lockScript(s), the number and value of outputs, lockScript sizes, lockScript(s), SIGHASH flag, and nLockTime.</li>
                        <li>Create a new transaction message using this information, adding the necessary inputs and outputs.</li>
                        <li>For transactions that require a signature, sign the transaction message for each input using the corresponding private key and the appropriate SIGHASH flag. The signature then becomes part of the unlockScript.</li>
                      </ol>
                      <p>When this process is correctly followed, you can generate a valid transaction message with an unlockScript that satisfies the lockScript, ready to be broadcast to the network.</p>
                    </div>
                </div>

                <div class="mb-3">
                    <label for="inputUnlockScript-0" class="form-label">Unlock Script:</label>
                    <input type="text" class="form-control" name="inputUnlockScript" id="inputUnlockScript-0">
                    <a class="input-unlock-script-info" data-bs-toggle="collapse" href="#inputUnlockScriptInfoContent" aria-expanded="false" aria-controls="inputUnlockScriptInfoContent">Unlock Script Info</a>
                      <div class="collapse" id="inputUnlockScriptInfoContent">
                        <p>The Unlock Script is the solution to the lockScript of the STO being spent. At this point, if the STO is encumbered with a P2PKH lockScript, we don't have the signature needed to generate the full unlockScript, so we use the lockScript in hexadecimal as a placeholder.</p>
                        <p>For STOs whose lockScript doesn't require a signature (no OP_CHECKSIG opcode in the lockScript (ASM)), you would simply provide the solution to the lockScript here.</p>
                        <p>However, for STOs like the coinbase block reward, a signature is required. After you've prepared the rest of the transaction data, you'll replace this placeholder with the actual unlockScript, which includes the signature and public key necessary to satisfy the P2PKH lockScript.</p>
                      </div>
                </div>

                <div class="mb-3">
                  <label for="inputSequence-0" class="form-label">Sequence:</label>
                  <input type="text" class="form-control" name="inputSequence" id="inputSequence-0">
                  <a class="input-sequence-info" data-bs-toggle="collapse" href="#inputSequenceInfoContent" aria-expanded="false" aria-controls="inputSequenceInfoContent">Sequence Info</a>
                    <div class="collapse" id="inputSequenceInfoContent">
                      <p>The Sequence, or nSequence, is a 4-byte Little Endian value that plays a key role in determining a transaction's "finality" along with the nLockTime field.</p>
                      <p>Finality refers to whether a transaction is valid and can be included in a block. A "final" transaction may be confirmed in a block, while a "non-final" transaction can become "final" at a later time.</p>
                      <p>If an input's nSequence is 0xFFFFFFFF, it's a "final input". If all inputs are final, the transaction is "final", irrespective of nLockTime. If one or more inputs are "non-final", the transaction's finality depends on nLockTime and the state of the blockchain.</p>
                      <p>nSequence can also be manipulated in payment channels, where altering the sequence number can facilitate content delivery or manage turn-taking in negotiations. For instance, an initial transaction might have an nSequence of FFFFFFFA, providing room for six negotiation rounds.</p>
                      <p>Therefore, the nSequence value you set, in conjunction with the nLockTime, can significantly impact when and whether a transaction is processed.</p>
                    </div>
                </div>
                  
                <div class="mb-3">
                  <label for="sighashFlag-0" class="form-label">SIGHASH Flag:</label>
                  <input type="text" id="sighashFlag-0" name="sighashFlag" placeholder="Enter SIGHASH flag (e.g. 41, 42, 43)" class="form-control" />
                  <a class="sighash-flag-info" data-bs-toggle="collapse" href="#sighashFlagInfoContent" aria-expanded="false" aria-controls="sighashFlagInfoContent">SIGHASH Flag Info</a>
                    <div class="collapse" id="sighashFlagInfoContent">
                      <p>The SIGHASH Flag plays a crucial role in a Bitcoin SV transaction by determining what parts of the transaction to hash for the signature.</p>
                      <p>Different SIGHASH flags specify different transaction components for hashing and signing. Here are some examples:</p>
                      <ul>
                        <li>SIGHASH_ALL (0x41): Hashes all inputs and outputs. The transaction can't be modified without invalidating the signature.</li>
                        <li>SIGHASH_NONE (0x42): Hashes all inputs but none of the outputs, allowing anyone to change where the Bitcoins are going.</li>
                        <li>SIGHASH_SINGLE (0x43): Hashes all inputs and one output - the one corresponding to this input. Other outputs can be changed.</li>
                      </ul>
                      <p>Each of these flags may also be appended with SIGHASH_ANYONECANPAY (0x80), which changes the hash to only include the single input being signed, allowing others to add or remove inputs, changing the transaction's total input value.</p>
                      <p>Therefore, the SIGHASH flag you choose can significantly impact the flexibility and security of your transaction.</p>
                    </div>
                </div>
    </template> 

    <input type="hidden" id="currentInputIndex" value="1">           
    <button type="button" class="btn btn-link p-0" data-bs-toggle="collapse" data-bs-target="#inputContainersWrapper">
    <h2>Inputs:</h2>
    </button>

    <div id="inputContainersWrapper" class="collapse show">
      <div id="inputContainers"></div>
    </div>

    <div class="mb-3">
      <label for="outputCount" class="form-label">Output Count:</label>
      <input type="text" class="form-control" id="outputCount" name="outputCount">
      <a class="output-count-info" data-bs-toggle="collapse" href="#outputCountInfoContent" aria-expanded="false" aria-controls="outputCountInfoContent">Output Count Info</a>
      <div class="collapse" id="outputCountInfoContent">
        <p>Output Count is a varInt that specifies the number of outputs in the transaction.</p>
        <p>The forms for each output will be dynamically created when a value is entered in the field above. This tool allows for a maximum of 5 outputs.</p>
        <p>Specify the desired values for each output in the dynamically created forms.</p>
      </div>
    </div>
  
    <template id="outputContainerTemplate">
        <div class="outputContainer mt-4">
            <button type="button" class="btn btn-link p-0 outputToggle" data-bs-toggle="collapse">
                <h3>Output #<span class="outputIndex"></span></h3>
            </button>
                <div class="collapse show outputContent">
                  <div class="mb-3">
                    <label for="outputValue-0" class="form-label">Value:</label>
                    <input type="text" class="form-control" id="outputValue-0" name="outputValue">
                    <a class="output-value-info" data-bs-toggle="collapse" href="#outputValueInfoContent" aria-expanded="false" aria-controls="outputValueInfoContent">Value Info</a>
                    <div class="collapse" id="outputValueInfoContent">
                      <p>Welcome to the 'Value' field, where you'll define the number of satoshis for the transaction output. This field expects an 8 byte Little Endian hexadecimal value.</p>
                      <p>As a good practice, ensure the total output value is less than the total input value, leaving room for the transaction fee. This fee is a token of appreciation to the mining node that confirms your transaction. On the RegTest Node, the minimum tip is a modest 50 satoshis, or 0.00000050 BSV.</p>
                      <p>Use the conversion tools beneath the Spendable Transaction Output Table to easily change the decimal to hex, and remember to pad the hex bytes of the satoshis with the right number of zeros before you switch the endianness. </p>
                    </div>
                  </div>
                  <div class="mb-3">
                    <label for="outputLockScriptSize-0" class="form-label">LockScript Size:</label>
                    <input type="text" class="form-control" name="outputLockScriptSize" id="outputLockScriptSize-0">
                    <a class="output-lock-script-size-info" data-bs-toggle="collapse" href="#outputLockScriptSizeInfoContent" aria-expanded="false" aria-controls="outputLockScriptSizeInfoContent">LockScript Size Info</a>
                    <div class="collapse" id="outputLockScriptSizeInfoContent">
                      <p>The 'LockScript Size' field refers to the length of the lockScript, expressed as a varInt, that the payee has chosen to encumber the satoshis of the output behind. As such, it represents the complexity of the conditions that must be met to spend the output.</p>
                    </div>
                  </div>
                  
                  <div class="mb-3">
                    <label for="outputLockScript-0" class="form-label">lockScript:</label>
                    <input type="text" class="form-control" name="outputLockScript" id="outputLockScript-0">
                    <a class="output-lock-script-info" data-bs-toggle="collapse" href="#outputLockScriptInfoContent" aria-expanded="false" aria-controls="outputLockScriptInfoContent">LockScript Info</a>
                    <div class="collapse" id="outputLockScriptInfoContent">
                        <p>The 'LockScript' field is the core of a transaction's conditions. It's written in Bitcoin's native language, Script, which can provide any calculable number, making the possibilities vast. Let's explore some standard transaction types:</p>
                
                        <h4>1. Pay to Public Key (P2PK)</h4>
                        <p>One of the simplest scripts, P2PK uses the security of Elliptic curve signatures to lock transaction outputs. Here's how it's defined and solved:</p>
                        <code>
                            P2PK Script: &lt;public_key&gt; OP_CHECKSIG<br>
                            Solution: &lt;signature&gt;
                        </code>
                
                        <h4>2. Pay to Hash Puzzle</h4>
                        <p>This script uses a hash function as the checking function, requiring the spending party to provide a valid solution to the puzzle. Here are some examples:</p>
                        <code>
                            Example 1: OP_SHA256 &lt;sha256_hash&gt; OP_EQUAL<br>
                            Example 2: OP_HASH256 &lt;double_sha256_hash&gt; OP_EQUAL<br>
                            Example 3: OP_SHA256 OP_RIPEMD160 &lt;ripemd160_hash&gt; OP_EQUAL<br>
                            Solution for Example 3: &lt;pre-hash_value&gt;
                        </code>
                
                        <h4>3. Pay to Public Key Hash (P2PKH)</h4>
                        <p>The most widely used locking script, P2PKH combines the security of elliptic curve signatures with a hash function. Here's how it's defined and solved:</p>
                        <code>
                            P2PKH Script: OP_DUP OP_HASH160 &lt;public_key_hash&gt; OP_EQUALVERIFY OP_CHECKSIG<br>
                            Solution: &lt;signature&gt; &lt;public_key&gt;
                        </code>
                
                        <h4>4. Pay to MultiSig (P2MS)</h4>
                        <p>P2MS uses the OP_CHECKMULTISIG opcode to check against multiple signatures and public keys. Here's how a 2of3 multisig script is defined and some possible solutions:</p>
                        <code>
                            2of3 P2MS Script: 2 &lt;pubkey_1&gt; &lt;pubkey_2&gt; &lt;pubkey_3&gt; 3 OP_CHECKMULTISIG<br>
                            Example Solutions:<br>
                            1. 1 &lt;signature_1&gt; &lt;signature_2&gt;<br>
                            2. 1 &lt;signature_1&gt; &lt;signature_3&gt;<br>
                            3. 1 &lt;signature_2&gt; &lt;signature_3&gt;
                        </code>
                
                        <h4>5. R-Puzzles</h4>
                        <p>R-Puzzles allow parties to provide the ephemeral keys to third parties to access specific outputs on the blockchain so that valid signatures can be created. Here's how an R-Puzzle script is defined:</p>
                        <code>
                            R-Puzzle Script: OP_3 OP_SPLIT OP_NIP OP_1 OP_SPLIT OP_SWAP OP_SPLIT OP_DROP &lt;r-value&gt; OP_EQUAL
                        </code>
                        
                        <h4>6. Pay to R-Puzzle Hash (P2RPH)</h4>
                        <p>This script includes a signature evaluation and a hash function. Here's how a P2RPH script is defined and solved:</p>
                        <code>
                            P2RPH Script: OP_OVER OP_3 OP_SPLIT OP_NIP OP_1 OP_SPLIT OP_SWAP OP_SPLIT OP_DROP OP_HASH160 &lt;r_hash&gt; OP_EQUALVERIFY OP_CHECKSIG<br>
                            Solution: &lt;signature&gt; &lt;public_key&gt;
                        </code>
                        
                        <p>Remember, the above examples are just the tip of the iceberg. Bitcoin's Script language consists of 186 opcodes used for flow control, arithmetic, cryptography, bitwise logic, and data manipulation, providing immense flexibility in scripting transactions.</p>
                    </div>
                  </div>
                        
                  
        </div>
    </template>

    <input type="hidden" id="currentOutputIndex" value="1">
    <button type="button" class="btn btn-link p-0" data-bs-toggle="collapse" data-bs-target="#outputContainersWrapper">
    <h2>Outputs:</h2>
    </button>

    <div id="outputContainersWrapper" class="collapse show">
      <div id="outputContainers"></div>
    </div>
                
    <div class="mb-3">
      <label for="nLockTime" class="form-label">nLockTime:</label>
      <input type="text" class="form-control" id="nLockTime" name="nLockTime">
      <a class="nLockTime-info" data-bs-toggle="collapse" href="#nLockTimeInfoContent" aria-expanded="false" aria-controls="nLockTimeInfoContent">nLockTime Info</a>
      <div class="collapse" id="nLockTimeInfoContent">
          <p>nLockTime is a 4 byte Little Endian value.</p>
          <p>If the value of the transaction’s nLockTime field is less than 500,000,000 then the field represents a block height.</p>
          <p>If the value of the transaction’s nLockTime field is greater or equal to 500,000,000 then the field represents a UNIX epoch timestamp.</p>
      </div>
  </div>
    
                
    <div><button type="button" id="processTransactionDataButton" class="btn btn-primary mt-2" style="display: block; margin-left: auto; margin-right: auto;">Process Transaction Data</button></div>

  </div>


  <!-- <div> -->
    <!-- Preimage Container -->
    <div class="container mt-5">
      <h2>Preimages</h2>
        <div id="transactionJSONContainer" class="mt-4"></div>
          <p>Fill in the fields below with the appropriate values extracted from the JSON displayed above. Some values will need to be gathered from the Spendable Transaction Output table as well.  Once you have populated the table, click the button at the bottom of each preimage form for its SIGHASH preimage to be displayed in the table below. </p>
          <div class="d-flex justify-content-center">
            <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                SIGHASH Help
            </button>
        </div>
        
        <div class="collapse" id="collapseExample">
          <div class="tableContainer">
            <table class="fieldTable">
              <thead>
                <tr>
                  <th rowspan="2">Field</th>
                  <th rowspan="2">Description</th>
                  <th rowspan="2">Byte Length</th>
                  <th rowspan="2">Endianness</th>
                  <th colspan="3">Standard</th>
                  <th colspan="3">ANYONECANPAY</th>
                </tr>
                <tr>
                  <th>SIGHASH_ALL</th>
                  <th>SIGHASH_NONE</th>
                  <th>SIGHASH_SINGLE</th>
                  <th>SIGHASH_ALL</th>
                  <th>SIGHASH_NONE</th>
                  <th>SIGHASH_SINGLE</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>nVersion</td>
                  <td>The version number of the transaction.</td>
                  <td>4</td>
                  <td>Little</td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td>hashPrevouts</td>
                  <td>The double SHA256 of the serialization of all input outpoints.</td>
                  <td>32</td>
                  <td>Little</td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td>32 bytes of zeros</td>
                  <td>32 bytes of zeros</td>
                  <td>32 bytes of zeros</td>
                </tr>
                <tr>
                  <td>hashSequence</td>
                  <td>The double SHA256 of the serialization of nSequence of all inputs.</td>
                  <td>32</td>
                  <td>Little</td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td>32 bytes of zeros</td>
                  <td>32 bytes of zeros</td>
                  <td>32 bytes of zeros</td>
                </tr>
                <tr>
                  <td>outpoint</td>
                  <td>The previous output transaction reference, as an OutPoint structure.</td>
                  <td>36</td>
                  <td>Little</td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td>lockScriptSize</td>
                  <td>Size of the lock script.</td>
                  <td>VarInt</td>
                  <td>Little</td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td>lockScript</td>
                  <td>The script that controls how the next person wanting to spend these Bitcoins can gain access to them.</td>
                  <td>Variable</td>
                  <td>N/A</td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td>value</td>
                  <td>The amount in Satoshis being spent from the outpoint to this input.</td>
                  <td>8</td>
                  <td>Little</td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td>nSequence</td>
                  <td>The sequence number of this input.</td>
                  <td>4</td>
                  <td>Little</td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td>hashOutputs</td>
                  <td>The double SHA256 of the serialization of all output amounts and scripts.</td>
                  <td>32</td>
                  <td>Little</td>
                  <td></td>
                  <td>32 bytes of zeros</td>
                  <td>If signing input index > #outputs, set to 32-byte zero	</td>
                  <td></td>
                  <td>32 bytes of zeros</td>
                  <td>If signing input index > #outputs, set to 32-byte zero	</td>
                </tr>
                <tr>
                  <td>nLockTime</td>
                  <td>The lock time indicating when this transaction can be added to the blockchain.</td>
                  <td>4</td>
                  <td>Little</td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td>sighash</td>
                  <td>The type of signature hash being used.</td>
                  <td>4</td>
                  <td>Little</td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
                </tbody>
              </table>
            </div>
        </div>
          <!-- <div class="card mt-4">
          <div class="card-header">
              <h3 class="mb-0">
                  <button class="btn btn-link custom-btn" type="button" data-bs-toggle="collapse" data-bs-target="#sighashHelp" aria-expanded="false" aria-controls="sighashHelp">
                      Click here for the SIGHASH preimage data templates!
                  </button>
              </h3>
          </div>
          <div id="sighashHelp" class="collapse">
              <div class="card-body"> 
                  <p> Hover over each SIGHASH scheme to see its data template.</p> 
                  <ul class="list-group mb-4" id="sighashMenu">
                      <li class="list-group-item">SIGHASH_ALL</li>
                      <li class="list-group-item">SIGHASH_NONE</li>
                      <li class="list-group-item">SIGHASH_SINGLE</li>
                      <li class="list-group-item">SIGHASH_ALL | SIGHASH_ANYONECANPAY</li>
                      <li class="list-group-item">SIGHASH_NONE | SIGHASH_ANYONECANPAY</li>
                      <li class="list-group-item">SIGHASH_SINGLE | SIGHASH_ANYONECANPAY</li>
                  </ul>
                  <p><ul>
                      <li>outpoint: The txid part of the outpoint needs to be in little-endian format. In the Spendable Transaction Output JSON, the txid is in big-endian format. You will need to reverse the byte order of the txid before using it in the outpoint field. The vout part of the outpoint is already in little-endian format, so you don't need to change its endianness.</li>
                      <li>nSequence: The nSequence value in the Spendable Transaction Output JSON is in big-endian format. You will need to convert it to little-endian format before using it in the nSequence field </li>
                      <li>value: The value in the Spendable Transaction Output JSON is in decimal format. You need to convert it to satoshis (in integer format) and then represent it in little-endian hexadecimal format for the value field of the baseTemplate.</li>
                      </ul>
                  </p>
              </div>
          </div> -->
        </div>

      <div id="preimagesContainer" class="row"></div>

      <template id="preimageFormTemplate">
          <div class="col-md-12 preimageWrapper">
            <button type="button" class="btn btn-link p-0 preimageToggle" data-bs-toggle="collapse" data-bs-target="#preimageContent-">
            <h4>Preimage #<span class="preimageIndex"></span></h4>
            </button>

          <div class="collapse preimageContent" id="preimageContent-">

            <form class="preimageForm">

              <div class="form-group">
                <label for="nVersion" class="form-label">nVersion:</label>
                <input type="text" class="form-control nVersion" id="nVersion" name="nVersion">
                <a class="nVersion-info" data-bs-toggle="collapse" href="#nVersionInfoContent" aria-expanded="false" aria-controls="nVersionInfoContent">nVersion Info</a>
                <div class="collapse" id="nVersionInfoContent">
                    <p>nVersion is a 4-byte Little Endian transaction version number.</p>
                    <p>It specifies the version of the transaction format and is included in the preimage to prevent version inconsistency, which could lead to transaction manipulation or incompatibility issues.</p>
                </div>
            </div>
            
            <div class="form-group">
                <label for="Prevouts" class="form-label">Prevouts:</label>
                <input type="text" class="form-control Prevouts" id="Prevouts" name="Prevouts">
                <a class="Prevouts-info" data-bs-toggle="collapse" href="#PrevoutsInfoContent" aria-expanded="false" aria-controls="PrevoutsInfoContent">Prevouts Info</a>
                <div class="collapse" id="PrevoutsInfoContent">
                    <p>Prevouts are transaction input outpoints.</p>
                    <p>They consist of a 32-byte TXID and a 4-byte VOUT, pointing to a specific output of a previous transaction being spent. Prevouts are serialized in little endian format and concatenated together for all inputs in the transaction. Including them in the preimage ensures the exact inputs being spent are locked, preventing any changes after the signature is generated.</p>
                </div>
            </div>
            
            <button class="hashButton hashPrevoutsButton btn btn-primary mb-3" type="button">Hash Data</button>
            
            <div class="form-group">
                <label for="hashPrevouts">hashPrevouts (32-byte hash of all input outpoints)</label>
                <input type="text" class="form-control hashPrevouts">
            </div>
            
            <div class="form-group">
                <label for="Sequence" class="form-label">Sequence:</label>
                <input type="text" class="form-control Sequence" id="Sequence" name="Sequence">
                <a class="Sequence-info" data-bs-toggle="collapse" href="#SequenceInfoContent" aria-expanded="false" aria-controls="SequenceInfoContent">Sequence Info</a>
                <div class="collapse" id="SequenceInfoContent">
                    <p>Sequence represents the transaction input sequence numbers.</p>
                    <p>It is a 4-byte field used for enabling relative locktimes for individual inputs within a transaction. If not used for relative locktime, the sequence number is typically set to 0xFFFFFFFF. The sequence numbers are serialized in little endian format and concatenated together for all inputs. Including the sequence field in the preimage ensures the integrity of the relative locktime feature, preventing any unauthorized changes to input locktimes after the signature is created.</p>
                </div>
            </div>
            
            <button class="hashButton hashSequenceButton btn btn-primary mb-3" type="button">Hash Data</button>
            
            <div class="form-group">
                <label for="hashSequence">hashSequence (32-byte hash of all input sequence numbers)</label>
                <input type="text" class="form-control hashSequence">
            </div>
            
                
                <div class="form-group">
                  <label for="outpoint" class="form-label">outpoint:</label>
                  <input type="text" class="form-control outpoint" id="outpoint" name="outpoint">
                  <a class="outpoint-info" data-bs-toggle="collapse" href="#outpointInfoContent" aria-expanded="false" aria-controls="outpointInfoContent">Outpoint Info</a>
                  <div class="collapse" id="outpointInfoContent">
                      <p>Outpoint represents the 36-byte outpoint of the input being signed.</p>
                      <p>This is included in the preimage to ensure that the signature commits to the exact input being spent, thus preventing transaction malleability.</p>
                  </div>
              </div>
              
              <div class="form-group">
                  <label for="scriptCode" class="form-label">scriptCode:</label>
                  <input type="text" class="form-control scriptCode" id="scriptCode" name="scriptCode">
                  <a class="scriptCode-info" data-bs-toggle="collapse" href="#scriptCodeInfoContent" aria-expanded="false" aria-controls="scriptCodeInfoContent">ScriptCode Info</a>
                  <div class="collapse" id="scriptCodeInfoContent">
                      <p>ScriptCode represents the lockScript of the output being spent, prefixed by its length.</p>
                      <p>This is included in the preimage to ensure that the signature is spending the correct UTXO (Unspent Transaction Output) with the specified script.</p>
                  </div>
              </div>
              
              <div class="form-group">
                  <label for="value" class="form-label">value:</label>
                  <input type="text" class="form-control value" id="value" name="value">
                  <a class="value-info" data-bs-toggle="collapse" href="#valueInfoContent" aria-expanded="false" aria-controls="valueInfoContent">Value Info</a>
                  <div class="collapse" id="valueInfoContent">
                      <p>Value represents the 8-byte value of the output being spent, in little-endian format.</p>
                      <p>This is included in the preimage to ensure the signature commits to the amount being spent, preventing any potential tampering of the amount after the signature is created.</p>
                  </div>
              </div>
              
              <div class="form-group">
                  <label for="nSequence" class="form-label">nSequence:</label>
                  <input type="text" class="form-control nSequence" id="nSequence" name="nSequence">
                  <a class="nSequence-info" data-bs-toggle="collapse" href="#nSequenceInfoContent" aria-expanded="false" aria-controls="nSequenceInfoContent">nSequence Info</a>
                  <div class="collapse" id="nSequenceInfoContent">
                      <p>nSequence represents the 4-byte sequence number of the input being signed.</p>
                      <p>This is included in the preimage to ensure that the signature commits to the input's sequence number, which can be used for various functions like enforcing relative locktime.</p>
                  </div>
              </div>
              
              <div class="form-group">
                <label for="Outputs" class="form-label">Outputs:</label>
                <input type="text" class="form-control Outputs" id="Outputs" name="Outputs">
                <a class="Outputs-info" data-bs-toggle="collapse" href="#OutputsInfoContent" aria-expanded="false" aria-controls="OutputsInfoContent">Outputs Info</a>
                <div class="collapse" id="OutputsInfoContent">
                    <p>Outputs represent the transaction output values, lockScripts, and their corresponding sizes.</p>
                    <p>Each output consists of a value (the number of satoshis to be spent), a lockScriptSize (the length of the lockScript), and a lockScript (the conditions needed to spend the output). They are included in the preimage to ensure the signature commits to the exact outputs of the transaction, including both the amount and the locking script. This prevents any potential changes to the outputs after the signature is created, thus securing the allocation of the transaction's funds.</p>
                </div>
            </div>
            
            
                
                <button class="hashButton hashOutputsButton btn btn-primary mb-3" type="button">Hash Data</button>
                
                <div class="form-group">
                    <label for="hashOutputs">hashOutputs (32-byte hash of output values and lockScripts)</label>
                    <input type="text" class="form-control hashOutputs">
                </div>
                
                <div class="form-group">
                  <label for="nLockTime" class="form-label">nLockTime:</label>
                  <input type="text" class="form-control nLockTime" id="nLockTime" name="nLockTime">
                  <a class="nLockTime-info" data-bs-toggle="collapse" href="#nLockTimeInfoContent" aria-expanded="false" aria-controls="nLockTimeInfoContent">nLockTime Info</a>
                  <div class="collapse" id="nLockTimeInfoContent">
                      <p>nLockTime is a 4-byte transaction lock time.</p>
                      <p>It determines the earliest time or the earliest block a transaction can be added to the blockchain. Including this in the preimage ensures the specific timing restrictions of the transaction cannot be changed without invalidating the signature.</p>
                  </div>
              </div>
              
              <div class="form-group">
                  <label for="nHashType" class="form-label">nHashType:</label>
                  <input type="text" class="form-control nHashType" id="nHashType" name="nHashType">
                  <a class="nHashType-info" data-bs-toggle="collapse" href="#nHashTypeInfoContent" aria-expanded="false" aria-controls="nHashTypeInfoContent">nHashType Info</a>
                  <div class="collapse" id="nHashTypeInfoContent">
                      <p>nHashType is a 4-byte SIGHASH type, in little-endian format.</p>
                      <p>This field determines which parts of the transaction the signature commits to. Including this in the preimage ensures that the signer's intention regarding what should and shouldn't be signed is preserved, preventing any unauthorized alterations to the transaction after the signature is generated.</p>
                  </div>
              </div>
              
              <button class="generatePreimageButton btn btn-primary mb-3" type="button">Generate Preimage</button>
              
              <div class="form-group">
                  <label for="preimage" class="form-label">SIGHASH Preimage:</label>
                  <input type="text" class="form-control preimage" id="preimage" readonly>
                  <a class="preimage-info" data-bs-toggle="collapse" href="#preimageInfoContent" aria-expanded="false" aria-controls="preimageInfoContent">Preimage Info</a>
                  <div class="collapse" id="preimageInfoContent">
                      <p>The SIGHASH Preimage is the dataset hashed to compute the signature for a Bitcoin transaction.</p>
                      <p>The preimage is critical for transaction security because it prevents tampering. If any part of the transaction covered by the signature is changed (including the fields covered by nHashType), the preimage changes, which changes the hash of the preimage, invalidating the signature. Thus, the preimage is an essential tool for maintaining the integrity of transactions on the Bitcoin network.</p>
                  </div>
              </div>
              

            </form>
          </div>
        </div>
      </template>


      <div>
        <h2>Sighash</h2>
        <div id="sighashContainer" class="mt-4">
          <div id="preimageTableContainer">
              <table id="preimageTable">
              <thead>
                  <tr>
                  <th>Input #</th>
                  <th>Preimage</th>
                  </tr>
              </thead>
              <tbody id="preimageTableBody"></tbody>
              </table>
          </div>
          <div id="preimageJSONContainer" class="col-md-12"></div>
          <nav>
              <ul id="preimageJSONPagination" class="pagination"></ul>
          </nav>
        </div>
  
        <button id="generateSighashButton" type="button" class="btn btn-primary mt-2" style="display: block; margin-left: auto; margin-right: auto;">Hash Preimages</button>
        <p>Now when we press the button, the PreImage will be double hashed with SHA256 to create the SigHash </p>
  
        <div id="sighashTableContainer" class="mt-4">
          <table id="sighashTable">
          <thead>
              <tr>
              <th>Input #</th>
              <th>SIGHASH</th>
              </tr>
          </thead>
          <tbody id="sighashTableBody"></tbody>
          </table>
        </div>
      </div>
  
      <div>
        <h2>Signature</h2>
        <div id="unsignedSighashTableContainer" class="mt-4">
            <table id="unsignedSighashTable">
              <thead>
                <tr>
                  <th>Input #</th>
                  <th>Unsigned SIGHASH</th>
                  <th>Private Key</th>
                </tr>
              </thead>
              <tbody id="unsignedSighashTableBody"></tbody>
            </table>
          </div>
  
          <button id="signSighash" class="btn btn-primary mt-2" style="display: block; margin-left: auto; margin-right: auto;">Sign SIGHASH</button>
          <p>Now when we press the button, we will sign the SIGHASH with the private key that solves the lockScript for the inputs we are spending and the signature will be presented in the table below. </p>
          
          <div id="signatureTableContainer" class="mt-4">
              <table id="signatureTable">
                <thead>
                  <tr>
                    <th>Input #</th>
                    <th>Signature</th>
                  </tr>
                </thead>
                <tbody id="signatureTableBody"></tbody>
              </table>
          </div>
        </div>
        
        <div id="unlockScriptContainer">
          <h2>UnlockScripts</h2>
          <!-- UnlockScript form sections will go here -->
        </div>
        
        <!-- This is a hidden template for the UnlockScript form sections -->
  <template id="unlockScriptFormTemplate">
    <div class="unlockScriptWrapper">
      <h3 class="unlockScriptIndex"></h3>
  
      <label for="lockScriptType" class="form-label">LockScript Type:</label>
      <select class="lockScriptType">
        <option value="p2pkh">P2PKH</option>
        <option value="custom">Custom</option>
        <!-- Add other lockScript types here -->
      </select>
  
      <div class="p2pkhFields">
        <label class="form-label">Signature:</label>
        <input type="text" class="signature" name="signature">
  
        <label class="form-label">SigHash Type:</label>
        <select class="sigHashType">
          <option value="41">ALL</option>
          <option value="42">NONE</option>
          <option value="43">SINGLE</option>
          <option value="C1">ALL | ANYONECANPAY</option>
          <option value="C2">NONE | ANYONECANPAY</option>
          <option value="C3">SINGLE | ANYONECANPAY</option>
        </select>
  
        <label class="form-label">Public Key:</label>
        <input type="text" class="publicKey" name="publicKey">
      </div>
  
      <div class="customFields" style="display: none;">
        <label class="form-label">Custom UnlockScript:</label>
        <textarea class="customUnlockScript"></textarea>
      </div>
  
      <button class="btn btn-primary mt-2 generateUnlockScriptButton">Generate UnlockScript</button>
  
      <div class="unlockScriptOutput mt-4">
        <label class="form-label">UnlockScript Size (bytes):</label>
        <pre class="border p-2 unlockScriptSizePre"></pre>
  
        <label class="form-label">UnlockScript:</label>
        <pre class="border p-2 unlockScriptOutputPre"></pre>
      </div>
    </div>
  </template>

  <div class="container">
    <div class="row">
        <div class="col">
            <h2>Raw Transaction Data</h2>
            <div id="transactionEditableJSONContainer" class="mt-4"></div>
            <p>Now that we have input the actual unlockScript and its size, when we press the button we concatenate all the values from the transaction's data fields, including the actual unlockScript from above to generate the raw serialised transaction data.</p>
            <div id="generateRawTxContainer" class="mt-4">
                <label for="generateRawTxPre" class="form-label">Raw Transaction Data:</label>
                <pre id="generateRawTxPre" class="border p-2"></pre>
            </div>
            <label for="serialisedRawTxData" class="form-label mt-4">Serialised Raw Transaction Data:</label>
            <div style="width: 80%; margin: 0 auto;">
                <textarea id="serialisedRawTxData" class="form-control" rows="3"></textarea>
            </div>
            <div class="mt-2 d-flex justify-content-center">
              <button id="generateTXIDButton" class="btn btn-primary mt-2 btn-space">Generate TXID</button>
              <button id="broadcastTX" class="btn btn-primary mt-2">Broadcast Transaction</button>
            </div>
            <label for="txidLeContainer" class="form-label mt-4">TXID (LE):</label>
            <div style="width: 80%; margin: 0 auto;">
              <input type="text" id="txidLeContainer" readonly style="width: 100%;">
            </div>
            <label for="txidBeContainer" class="form-label mt-4">TXID (BE):</label>
            <div style="width: 80%; margin: 0 auto;">
              <input type="text" id="txidBeContainer" readonly style="width: 100%;">
            </div>
        </div>
    </div>
</div>


    <div>
      <h2>Check Transaction Status</h2>
      <input type="text" id="txidInput" placeholder="Enter Transaction ID" />
      <button id="checkTxStatus" class="btn btn-primary mt-2" style="display: block; margin-left: auto; margin-right: auto;">Check Transaction Status</button>
      <p id="txStatusResult">Transaction Status Will Be Displayed Here</p>
      <button id="mineOneBlock" class="btn btn-primary mt-2">Mine 1 Block</button>
    </div>
  </div>
  </div>    

  

</div>   
    
<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
 <script type="module" src="/src/scripts.js" defer></script>

</body>
    
</html>
    
