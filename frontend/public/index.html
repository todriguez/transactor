<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BSV TX PLAYGROUND</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script> var exports = {}; </script>
</head>
  

<body>
    <div class="container mt-4">
        <h1 class="mb-4" style="text-align: center;">BSV TX PLAYGROUND</h1>
        <div><p>To start building bitcoin transactions, we need to generate public and private keys which we can use for our locking and unlocking transaction outputs as well as signing transactions and messages.</p>
            <button id="generatekeypair" class="btn btn-primary mt-2" style="display: block; margin-left: auto; margin-right: auto;">Generate Key Pair</button>
            <div>
                <table id="keypair" class="table table-striped mt-4">
                    <thead>
                        <tr>
                            <th>Index</th>
                            <th>Public Key</th>
                            <th>Private Key</th>
                            <th>Address</th>
                        </tr>
                    </thead>
                    <tbody id="keypairTableBody"></tbody>
                </table>
            </div>
            <label for="keyPairSelector" class="form-label">Select key pair index:</label>
                <select class="form-select" id="keyPairSelector" name="keyPairSelector">
                </select>
                
                <button id="mineBlocks" class="btn btn-primary mt-2" style="display: block; margin-left: auto; margin-right: auto;">Mine Blocks</button>
                <div id="spendableTransactionOutputs" class="mt-4">
                    <h2 style="text-align: center;">Spendable Transaction Outputs</h2>
                    <table id="stoTable" class="table table-striped">
                        <thead>
                            <tr>
                              <th>Index</th>
                              <th>Block Height</th>
                              <th>Block Hash</th>
                              <th>VOUT</th>
                              <th>TXID</th>
                              <th>Value</th>
                              <th>lockScript ASM</th>
                              <th>lockScript Hex</th>
                              <th>Req Sigs</th>
                              <th>Confs</th>
                              <th>Private Key</th>
                            </tr>
                          </thead>
                        <tbody></tbody>
                    </table>
                </div>
                </div>
        

        <div id="transactionContainer" class="mt-4">
        <h1 style="text-align: center;">Create Transaction</h1>
            <form id="transactionForm" onsubmit="return false;">
                <div class="mb-3">
                    <label for="Version" class="form-label">Version:</label>
                    <input type="text" class="form-control" id="version" name="Version">
                     
                </div>
                
                <div class="mb-3">
                    <label for="inputCount" class="form-label">Input Count:</label>
                    <input type="text" class="form-control" id="inputCount" name="inputCount">
                </div>

                
    <template id="inputContainerTemplate">
        <div id="inputContainer" class="mt-4">
            <h3>Input</h3>
            <div class="mb-3">
                <label for="inputTXID-0" class="form-label">TXID:</label>
                <input type="text" class="form-control" name="inputTXID" id="inputTXID-0">
                    <p>Enter the TXID that contains the outputs you want to spend. This will be a 32 byte Little Endian value.</p>
                </div>
                <div class="mb-3">
                    <label for="inputVOUT-0" class="form-label">VOUT:</label>
                    <input type="text" class="form-control" name="inputVOUT" id="inputVOUT-0">
                    <p>The VOUT refers to the index position of the Transaction Output you want to spend from amongst whichever additional outputs were generated when the initial transaction was created. In this case all our Spendable Transaction Outputs are coinbase with only one output so their VOUT will be 0 as the first position in the transaction outputs. This needs to be entered as a 4 byte Little Endian value.</p>
                    
                </div>
                
                <div class="mb-3">
                    <label for="inputUnlockScriptSize-0" class="form-label">Unlock Script Size:</label>
                    <input type="text" class="form-control" name="inputUnlockScriptSize" id="inputUnlockScriptSize-0">
                    
                    
                </div>
                <div class="mb-3">
                    <label for="inputUnlockScript-0" class="form-label">Unlock Script:</label>
                    <input type="text" class="form-control" name="inputUnlockScript" id="inputUnlockScript-0">
                    <p>At this point, this is the lockScript of the output being spent in hexadecimal.</p>
                </div>
                <div class="mb-3">
                    <label for="inputSequence-0" class="form-label">Sequence:</label>
                    <input type="text" class="form-control" name="inputSequence" id="inputSequence-0">
                    
                    
                </div>       
                <div class="mb-3">
                    <label for="sighashFlag-0" class="form-label">SIGHASH Flag:</label>
                    <input type="text" id="sighashFlag-0" name="sighashFlag" placeholder="Enter sighash flag (e.g. 41, 42, 43)" class="form-control" />
                    
                          
        </div>
    </template> 
    <input type="hidden" id="currentInputIndex" value="1">           
    <div id="inputContainers"></div>

                <div class="mb-3">
                    <label for="outputCount" class="form-label">Output Count:</label>
                    <input type="text" class="form-control" id="outputCount" name="outputCount">
                    <p>"Output Count" is a varInt which specifies the number of outputs that will be generated by the transaction. This will be either a 1, 3, 5, or 9 byte value.</p>
                </div>

    <template id="outputContainerTemplate">
        <div id="outputContainer" class="mt-4">
            <h3>Output</h3>
            <div class="mb-3">
              <label for="outputValue-0" class="form-label">Value:</label>
              <input type="text" class="form-control" name="outputValue" id="outputValue-0">
                         <p>"Value" is an 8 byte Little Endian value designating the value in satoshis for the transaction output. This will need to be less than the value of the inputs, with an appropriate difference that will be collected by the mining node. The RegTest Node has a minminingtxfee=0.00000050 or 50 sats.</p>
                    </div>
                    <div class="mb-3">
                        <label for="outputlockScriptSize-0" class="form-label">lockScript Size:</label>
                        <input type="text" class="form-control" name="ouputlockScriptSize" id="outputlockScriptSize-0">
                        <p>This is the length of the script that the payee choses to encumber the satoshis of the output behind.</p>
                    </div>
                    <div class="mb-3">
                        <label for="outputlockScript-0" class="form-label">lockScript:</label>
                        <input type="text" class="form-control" name="outputlockScript" id="outputlockScript-0">
                        <p>This is the script that needs to be solved to onspend the satoshis of the output.</p>
                        <p>This is where the real magic of bitcoin happens, as this script can require the provision of any calculable number in Bitcoin's native language, Script.</p>
                        <p>Bitcoin Script consists of 186 opcodes which can be used for flow control, arithmetic, cryptography, bitwise logic, and data manipulation. </p>
                    </div>
                        
                    </div>
                <div>
        </div>
    </template>            
    <div id="outputContainers"></div>
                
                    <h3>nLockTime</h3>
                <div class="mb-3">
                    <label for="nLockTime" class="form-label">nLockTime:</label>
                    <input type="text" class="form-control" id="nLockTime" name="nLockTime">
                    <p>nLockTime is a 4 byte Little Endian value.</p>
                    <p>If the value of the transaction’s nLockTime field is less than 500,000,000 then the field represents a block height.</p>
                    <p>If the value of the transaction’s nLockTime field is greater or equal to 500,000,000 then the field represents a UNIX epoch timestamp.</p>
                </div>

                </div>
                </div>
                <div>
                    <h2>PreImage</h2>
                    <button id="displayPreImagesButton" class="btn btn-primary mt-2" style="display: block; margin-left: auto; margin-right: auto;">Display Preimages</button>
                    <p>Now when we press the button, all the values of the transaction's data fields will be concatenated together in order to provide us the serialised data that will be hashed to create the SigHash.</p>
                    <div id="preImageContainer" class="mt-4">
                      <!-- Preimages will be dynamically added here -->
                    </div>
                  </div>  
                  <div>
                    <h2>Sighash</h2>
                    <button id="createSighashButton" class="btn btn-primary mt-2" style="display: block; margin-left: auto; margin-right: auto;">Create Sighash</button>
                    <p>Now when we press the button, the PreImage will be double hashed with SHA256 to create the SigHash </p>
                    <div id="sighashContainer" class="mt-4"></div>
                  </div>
                  
                </div>
                <div>
                    <h2>Signature</h2>
                    <button id="signSigHash" class="btn btn-primary mt-2" style="display: block; margin-left: auto; margin-right: auto;">Sign SigHash</button>
                    <p>Now when we press the button, we will sign the SigHash with the private key that solves the lockScript for the inputs we are spending and the signature will be presented in the table below. </p>
                    <div id="Signature" class="mt-4">
                        <label for="signature" class="form-label">Signature:</label>
                        <pre id="signature" class="border p-2"></pre>
                    </div>
                </div>
                <div>
                    <h2>unlockScript</h2>
                    <button id="generateunlockScript" class="btn btn-primary mt-2" style="display: block; margin-left: auto; margin-right: auto;">Generate unlockScript</button>
                    <p>Now when we press the button, we concatenate the signature of the transaction, and public key associated with the private key that signed the transaction.</p>
                    <div id="unlockScript" class="mt-4">
                        <label for="unlockScript" class="form-label">unlockScript:</label>
                        <pre id="unlockScript" class="border p-2"></pre>
                    </div></div>
                
                <div>
                    <h2>Raw Transaction Data</h2>
                    <button id="generateRawTx" class="btn btn-primary mt-2" style="display: block; margin-left: auto; margin-right: auto;">Generate Raw Transaction Data</button>
                    <p>Now when we press the button, we concatenate all the values from the transaction's data fields, including the actual unlockScript from above.</p>
                    <div id="generateRawTx" class="mt-4">
                        <label for="generateRawTx" class="form-label">Raw Transaction Data:</label>
                        <pre id="generateRawTx" class="border p-2"></pre>
                    </div>
                </div>
                <div>
                    <h2>Generate TXID</h2>
                    <button id="generateTXID" class="btn btn-primary mt-2" style="display: block; margin-left: auto; margin-right: auto;">Generate TXID</button>
                    <p>Now when we press the button, we double hash (sha256) the raw transaction data to get the TXID. This value will be displayed in Little Endian. </p>
                        <label for="generateTXID" class="form-label">TXID:</label>
                        <pre id="generateTXID" class="border p-2"></pre>
                </div>
                <div>
                    <h2>Broadcast Transaction</h2>
                    <button id="broadcastTX" class="btn btn-primary mt-2" style="display: block; margin-left: auto; margin-right: auto;">Broadcast Transaction</button>
                    <p>When we press the button, we will broadcast the transaction to the RegTest Node through an RPC command. </p>
                </div>
       
</form>
</div>
            
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
    <script type="module" src="/src/scripts.js" defer></script>

  
    
</body>
    
</html>
    
